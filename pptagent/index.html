<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ÏÉùÍ∞Å ÏãúÍ∞ÅÌôî</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>AI ÏÉùÍ∞Å ÏãúÍ∞ÅÌôî</h1>
        
        <!-- onsubmit="return false" Ï∂îÍ∞ÄÌïòÏó¨ Í∏∞Î≥∏ Ï†úÏ∂ú ÎèôÏûë Ï∞®Îã® -->
        <div class="input-section">
            <form id="userInputForm" onsubmit="return false;">
                <textarea id="userInput" name="user_input" placeholder="ÏßÄÏãúÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">Please translate in Korean in ppt slide number 1.</textarea>
                <div class="checkbox-container">
                    <input type="checkbox" id="ruleBase" name="rule_base">
                    <label for="ruleBase">Rule Base Apply</label>
                </div>
                <button type="button" id="submitBtn">Ïã§Ìñâ</button>
            </form>
        </div>
        
        <!-- ÎîîÎ≤ÑÍπÖ ÏÑπÏÖò Ï∂îÍ∞Ä -->
        <div class="debug-section">
            <h3>ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥</h3>
            <pre id="debugOutput">Ï§ÄÎπÑ ÏôÑÎ£å...</pre>
        </div>
        
        <!-- Î™®Îìú Ï†ÑÌôò Î≤ÑÌäº -->
        <div class="view-toggle">
            <button id="singleViewBtn" class="active">Îã®Í≥ÑÎ≥Ñ Î≥¥Í∏∞</button>
            <button id="expandViewBtn">Ï†ÑÏ≤¥ ÌéºÏπòÍ∏∞</button>
        </div>
        
        <!-- Îã®Ïùº Î≥¥Îìú Î∑∞ -->
        <div id="singleBoardView" class="thinking-board active">
            <div class="board-header">
                <div class="step-icon" id="current-icon">üß†</div>
                <div class="step-title" id="current-title">ÎåÄÍ∏∞ Ï§ë...</div>
                <div class="step-time" id="current-time"></div>
            </div>
            <div class="board-content">
                <div class="thinking-indicator" id="current-thinking">
                    <div class="dot dot1"></div>
                    <div class="dot dot2"></div>
                    <div class="dot dot3"></div>
                </div>
                <pre class="output" id="current-output"></pre>
            </div>
            
            <!-- ÏßÑÌñâ ÏÉÅÌÉú ÌëúÏãú -->
            <div class="progress-indicator">
                <div class="progress-step" data-step="planner">Í≥ÑÌöç</div>
                <div class="progress-step" data-step="parser">Î∂ÑÏÑù</div>
                <div class="progress-step" data-step="processor">Ï≤òÎ¶¨</div>
                <div class="progress-step" data-step="applier">Ï†ÅÏö©</div>
                <div class="progress-step" data-step="reporter">Î≥¥Í≥†</div>
                <div class="progress-step" data-step="complete">ÏôÑÎ£å</div>
            </div>
        </div>
        
        <!-- Ï†ÑÏ≤¥ ÌéºÏπòÍ∏∞ Î∑∞ -->
        <div id="expandedView" class="thinking-container">
            <div class="thinking-step" id="planner">
                <div class="step-header">
                    <div class="step-icon">üß†</div>
                    <div class="step-title">Í≥ÑÌöç ÏàòÎ¶Ω</div>
                    <div class="step-time" id="planner-time"></div>
                </div>
                <div class="step-content">
                    <div class="thinking-indicator" id="planner-thinking">
                        <div class="dot dot1"></div>
                        <div class="dot dot2"></div>
                        <div class="dot dot3"></div>
                    </div>
                    <pre class="output" id="planner-output"></pre>
                </div>
            </div>
            
            <div class="thinking-step" id="parser">
                <div class="step-header">
                    <div class="step-icon">üìä</div>
                    <div class="step-title">Í≥ÑÌöç Î∂ÑÏÑù</div>
                    <div class="step-time" id="parser-time"></div>
                </div>
                <div class="step-content">
                    <div class="thinking-indicator" id="parser-thinking">
                        <div class="dot dot1"></div>
                        <div class="dot dot2"></div>
                        <div class="dot dot3"></div>
                    </div>
                    <pre class="output" id="parser-output"></pre>
                </div>
            </div>
            
            <div class="thinking-step" id="processor">
                <div class="step-header">
                    <div class="step-icon">‚öôÔ∏è</div>
                    <div class="step-title">Ï≤òÎ¶¨</div>
                    <div class="step-time" id="processor-time"></div>
                </div>
                <div class="step-content">
                    <div class="thinking-indicator" id="processor-thinking">
                        <div class="dot dot1"></div>
                        <div class="dot dot2"></div>
                        <div class="dot dot3"></div>
                    </div>
                    <pre class="output" id="processor-output"></pre>
                </div>
            </div>
            
            <div class="thinking-step" id="applier">
                <div class="step-header">
                    <div class="step-icon">üîÑ</div>
                    <div class="step-title">Ï†ÅÏö©</div>
                    <div class="step-time" id="applier-time"></div>
                </div>
                <div class="step-content">
                    <div class="thinking-indicator" id="applier-thinking">
                        <div class="dot dot1"></div>
                        <div class="dot dot2"></div>
                        <div class="dot dot3"></div>
                    </div>
                    <pre class="output" id="applier-output"></pre>
                </div>
            </div>
            
            <div class="thinking-step" id="reporter">
                <div class="step-header">
                    <div class="step-icon">üìù</div>
                    <div class="step-title">Î≥¥Í≥†ÏÑú ÏûëÏÑ±</div>
                    <div class="step-time" id="reporter-time"></div>
                </div>
                <div class="step-content">
                    <div class="thinking-indicator" id="reporter-thinking">
                        <div class="dot dot1"></div>
                        <div class="dot dot2"></div>
                        <div class="dot dot3"></div>
                    </div>
                    <pre class="output" id="reporter-output"></pre>
                </div>
            </div>
            
            <div class="thinking-step" id="final-result">
                <div class="step-header">
                    <div class="step-icon">‚úÖ</div>
                    <div class="step-title">ÏµúÏ¢Ö Í≤∞Í≥º</div>
                    <div class="step-time" id="total-time"></div>
                </div>
                <div class="step-content">
                    <pre class="output" id="final-output"></pre>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÌéòÏù¥ÏßÄ ÎÇ¥Ïóê ÏßÅÏ†ë Ïä§ÌÅ¨Î¶ΩÌä∏ Ìè¨Ìï® -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM Î°úÎìúÎê®!');
        
        // ÎîîÎ≤ÑÍπÖ Ï∂úÎ†• Ìï®Ïàò
        function debug(message) {
            const debugOutput = document.getElementById('debugOutput');
            debugOutput.textContent += '\n' + message;
            console.log(message);
        }
        
        debug('Ïä§ÌÅ¨Î¶ΩÌä∏ Ï¥àÍ∏∞Ìôî...');
        
        // ÏöîÏÜå Ï∞∏Ï°∞
        const userInput = document.getElementById('userInput');
        const ruleBase = document.getElementById('ruleBase');
        const submitBtn = document.getElementById('submitBtn');
        const singleViewBtn = document.getElementById('singleViewBtn');
        const expandViewBtn = document.getElementById('expandViewBtn');
        
        // Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        submitBtn.addEventListener('click', function() {
            debug('Ïã§Ìñâ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®!');
            
            const inputValue = userInput.value.trim();
            if (!inputValue) {
                alert('ÏßÄÏãúÏÇ¨Ìï≠ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            debug(`ÏûÖÎ†•Í∞í: ${inputValue}`);
            debug(`Í∑úÏπô Í∏∞Î∞ò: ${ruleBase.checked}`);
            
            // Ìèº Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
            const formData = new FormData();
            formData.append('user_input', inputValue);
            formData.append('rule_base', ruleBase.checked);
            
            // Ï≤òÎ¶¨ Ï§ë ÏÉÅÌÉú ÌëúÏãú
            document.getElementById('current-icon').textContent = '‚è≥';
            document.getElementById('current-title').textContent = 'ÏöîÏ≤≠ Ï≤òÎ¶¨ Ï§ë...';
            document.getElementById('current-thinking').style.display = 'flex';
            
            // AJAX ÏöîÏ≤≠
            debug('ÏÑúÎ≤ÑÏóê ÏöîÏ≤≠ Î≥¥ÎÇ¥Îäî Ï§ë...');
            fetch('/process', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                debug(`ÏÑúÎ≤Ñ ÏùëÎãµ ÏÉÅÌÉú: ${response.status}`);
                return response.json();
            })
            .then(data => {
                debug(`ÏùëÎãµ Îç∞Ïù¥ÌÑ∞: ${JSON.stringify(data)}`);
                
                if (data.status === 'processing') {
                    debug('Ìè¥ÎßÅ ÏãúÏûë...');
                    pollUpdates();
                } else {
                    debug(`Ïò§Î•ò: ${JSON.stringify(data)}`);
                    alert('Ïò§Î•ò: ' + JSON.stringify(data));
                }
            })
            .catch(error => {
                debug(`Ïò§Î•ò Î∞úÏÉù: ${error}`);
                alert('Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error);
            });
        });
        
        // Î∑∞ Ï†ÑÌôò Î≤ÑÌäº
        singleViewBtn.addEventListener('click', function() {
            debug('Îã®Í≥ÑÎ≥Ñ Î≥¥Í∏∞ ÏÑ†ÌÉù');
            singleViewBtn.classList.add('active');
            expandViewBtn.classList.remove('active');
            document.getElementById('singleBoardView').classList.add('active');
            document.getElementById('expandedView').classList.remove('active');
        });
        
        expandViewBtn.addEventListener('click', function() {
            debug('Ï†ÑÏ≤¥ ÌéºÏπòÍ∏∞ ÏÑ†ÌÉù');
            expandViewBtn.classList.add('active');
            singleViewBtn.classList.remove('active');
            document.getElementById('expandedView').classList.add('active');
            document.getElementById('singleBoardView').classList.remove('active');
        });
        
        // ÏóÖÎç∞Ïù¥Ìä∏ Ìè¥ÎßÅ Ìï®Ïàò
        function pollUpdates() {
            fetch('/thinking_updates')
                .then(response => response.json())
                .then(data => {
                    debug(`ÏóÖÎç∞Ïù¥Ìä∏: ${JSON.stringify(data).substring(0, 100)}...`);
                    
                    // Í∞ÅÏ¢Ö ÏóÖÎç∞Ïù¥Ìä∏ Ï≤òÎ¶¨ Î°úÏßÅ
                    if (data.status === 'waiting') {
                        setTimeout(pollUpdates, 500);
                    } else if (data.status === 'finished') {
                        debug('Ï≤òÎ¶¨ ÏôÑÎ£å');
                    } else if (data.status === 'error') {
                        debug(`Ïò§Î•ò: ${data.message}`);
                        alert('Ïò§Î•ò: ' + data.message);
                    } else {
                        // Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨ (Ïó¨Í∏∞ÏÑúÎäî ÏÉùÎûµ)
                        handleUpdate(data);
                        setTimeout(pollUpdates, 500);
                    }
                })
                .catch(error => {
                    debug(`Ìè¥ÎßÅ Ïò§Î•ò: ${error}`);
                    setTimeout(pollUpdates, 1000);
                });
        }
        
        // ÏóÖÎç∞Ïù¥Ìä∏ Ï≤òÎ¶¨ Ìï®Ïàò
        function handleUpdate(data) {
            const step = data.step;
            const status = data.status;
            
            // ÌòÑÏû¨ Îã®Í≥Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('current-icon').textContent = getStepIcon(step);
            document.getElementById('current-title').textContent = getStepTitle(step);
            
            // ÏßÑÌñâ ÏÉÅÌÉú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.progress-step').forEach(el => {
                if (el.dataset.step === step) {
                    el.classList.add('active');
                }
            });
            
            if (status === 'thinking') {
                document.getElementById('current-thinking').style.display = 'flex';
                document.getElementById('current-output').textContent = '';
            } else if (status === 'complete') {
                document.getElementById('current-thinking').style.display = 'none';
                
                if (data.data) {
                    let formattedData = typeof data.data === 'object' 
                        ? JSON.stringify(data.data, null, 2) 
                        : data.data;
                    
                    document.getElementById('current-output').textContent = formattedData;
                    document.getElementById('current-output').classList.add('visible');
                }
                
                if (data.time) {
                    document.getElementById('current-time').textContent = 
                        `ÏÜåÏöî ÏãúÍ∞Ñ: ${data.time.toFixed(2)}Ï¥à`;
                }
            }
        }
        
        // Îã®Í≥ÑÎ≥Ñ ÏïÑÏù¥ÏΩò Î∞òÌôò
        function getStepIcon(step) {
            const icons = {
                'planner': 'üß†',
                'parser': 'üìä',
                'processor': '‚öôÔ∏è',
                'applier': 'üîÑ',
                'reporter': 'üìù',
                'complete': '‚úÖ'
            };
            return icons[step] || '‚è≥';
        }
        
        // Îã®Í≥ÑÎ≥Ñ Ï†úÎ™© Î∞òÌôò
        function getStepTitle(step) {
            const titles = {
                'planner': 'Í≥ÑÌöç ÏàòÎ¶Ω',
                'parser': 'Í≥ÑÌöç Î∂ÑÏÑù',
                'processor': 'Ï≤òÎ¶¨',
                'applier': 'Ï†ÅÏö©',
                'reporter': 'Î≥¥Í≥†ÏÑú ÏûëÏÑ±',
                'complete': 'ÏµúÏ¢Ö Í≤∞Í≥º'
            };
            return titles[step] || 'Ï≤òÎ¶¨ Ï§ë...';
        }
    });
    </script>
</body>
</html>